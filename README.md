# Flask-Elastic-Beanstalk


Note, the best way to use this repo is to "fork it", delete the .elasticbeanstalk directory and replace it with yours generated by the `eb init`.  Also change the `buildspec.yml` file `eb deploy` to your app name.

![eb-deploy](https://user-images.githubusercontent.com/58792/106804626-a3a81900-6633-11eb-9cf6-54c24af6827f.png)



### Deploy via AWs Cloud9 + AWS Code Build

*Video here https://www.youtube.com/watch?v=PkJBn3X4LYw

*You can refer to tutorial [here as well for Flask EB](https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create-deploy-python-flask.html)*

A.  check out this repo and cd into it

B.  create a python virtualenv and source it and run `make all`

```
python3 -m venv ~/.eb
source ~/.eb/bin/activate
make all
```

### Docker

```
git clone https://github.com/marilynwaldman/kern-ec2.git
sudo apt-get update
sudo apt-get install docker-compose
```


#  from here:

https://github.com/russellromney/docker-dash/blob/master/README.md


Reqs: Python 3, AWS CLI, Docker
Install Docker, Python 3, and AWS CLI if not already done.

If needed, configure AWS CLI with aws configure.

Build the Docker image locally and teset
Build:

docker build -t docker-dash .

Test:

docker run -p 8050:8050 docker-dash

Send image to AWS ECR (Elastic Container Registry)
Create a repository in AWS ECR:

aws ecr create-repository --repository-name <my-repo-name>

Get login auth token:

aws ecr get-login --region us-east-1 --no-include-email

Copy and paste the output of the above command back into the terminal. You're authenticated locally for 12 hours.

Tag the image to the ECR repo with:

docker tag docker-dash:latest ACCT_ID.dkr.ecr.us-east-1.amazonaws.com/<my-repo-name>

Push the image to AWS ECR with:

docker push ACCT_ID.dkr.ecr.us-east-1.amazonaws.com/<my-repo-name>

Finally, you're done with the command line!

Deploy the Dash app with ECS (Elastic Container Service)
Follow the instructions in step 4 here: https://linuxacademy.com/blog/linux-academy/deploying-a-containerized-flask-application-with-aws-ecs-and-docker/

While doing this, I find it easier to change the names to match -service, -cluster, etc. to make it consistent to refer back to later.

Updating
If you need to make changes later, you need to build, test, login (if token expired), tag, and push to get the image to ECR. Then run the following command in the terminal:

aws ecs update-service --cluster <cluster name> --service <service name> --force-new-deployment

This will force the service to reload with the new code.



*Note, that awsebcli is installed via requirements*

```
git rm .elasticbeanstock


```

C. initialize new eb app
```
eb init -p python-3.7 dash-maps --region us-west-2

```

*Optional `eb init` again to create ssh keys*

D. Create remote eb instance

```
eb create dash-map-env -i t2.large

```

E.  Setup AWS Code Build Project

[View Sample `buildspec.yml` Config Here](https://github.com/noahgift/Flask-Elastic-Beanstalk/blob/main/buildspec.yml)

F.  Suggested next steps (Convert to ML Engineering project [like this project](https://github.com/noahgift/flask-ml-azure-serverless))

### Other Resources

* [Complete Walkthrough of Process on O'Reilly Platform](https://learning.oreilly.com/videos/aws-elastic-beanstalk/62022021VIDEOPAIML/62022021VIDEOPAIML-c1_s0)
* [Previous YouTube Walkthrough](https://youtu.be/iSv-i1tWpQc)


Notes on cloudl9
git clone https://github.com/marilynwaldman/Flask-Eb-map-server.git
cd Flask-Eb-map-server
python3 -m venv ~/.eb
source ~/.eb/bin/activate
make all
git rm -r .elasticbeanstalk
eb init -p python-3.7 flask-map-cd --region us-west-2
eb init
eb create flask-map-cd-env

eb create EngineTestEnv --profile eb-cli -d -i t2.large -k elastic_bs --single

